{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport ProductList from '@/components/ProductList.vue';\nimport JSONbig from 'json-bigint';\nexport default {\n  name: 'UserHome',\n  components: {\n    ProductList\n  },\n  data() {\n    return {\n      searchQuery: '',\n      showCategoryDropdown: false,\n      cartCount: 0,\n      selectedCategory: null,\n      username: localStorage.getItem('username') || '用户',\n      categories: [{\n        id: 1,\n        name: '白酒'\n      }, {\n        id: 2,\n        name: '红酒'\n      }, {\n        id: 3,\n        name: '啤酒'\n      }, {\n        id: 4,\n        name: '洋酒'\n      }, {\n        id: 5,\n        name: '黄酒'\n      }, {\n        id: 6,\n        name: '果酒'\n      }, {\n        id: 7,\n        name: '保健酒'\n      }, {\n        id: 8,\n        name: '其他酒类'\n      }],\n      products: [] // 原来是写死数组，现在为空\n    };\n  },\n  computed: {\n    filteredProducts() {\n      let list = this.products;\n      if (this.selectedCategory) {\n        list = list.filter(p => p.category === this.selectedCategory);\n      }\n      if (this.searchQuery) {\n        list = list.filter(p => p.name.includes(this.searchQuery));\n      }\n      return list;\n    }\n  },\n  methods: {\n    handleSearch() {\n      console.log('搜索:', this.searchQuery);\n    },\n    filterByCategory(categoryId) {\n      this.selectedCategory = this.categories.find(c => c.id === categoryId).name;\n      this.showCategoryDropdown = false;\n    },\n    switchTab(tab) {\n      if (tab === 'user_profile') this.$router.push('/user_profile');\n    },\n    addToCart(product) {\n      this.cartCount++;\n      console.log('添加到购物车:', product.name);\n    },\n    async loadRandomProducts() {\n      try {\n        const res = await fetch('http://localhost:8081/api/random?limit=5');\n        const text = await res.text(); // 🔥先看原始字符串\n        //console.log('原始响应文本:', text);\n        const list = JSONbig.parse(text); // 🔥再解析 JSON\n        //console.log('解析后第一个商品ID:', list[0].id, typeof list[0].id);\n        this.products = list.map(p => {\n          // 先保证 images 一定是数组\n          let imgs = [];\n          if (Array.isArray(p.images)) {\n            imgs = p.images;\n          } else if (typeof p.images === 'string' && p.images.trim().startsWith('[')) {\n            try {\n              imgs = JSON.parse(p.images);\n            } catch {/* ignore */}\n          }\n          return {\n            ...p,\n            id: String(p.id),\n            // 🔥关键修复：防止精度丢失\n            firstImage: imgs.length ? imgs[0] : null\n          };\n        });\n      } catch (e) {\n        console.error('拉取商品失败', e);\n      }\n    },\n    logout() {\n      localStorage.clear();\n      this.$message?.success?.('已退出登录');\n      this.$router.push('/');\n    }\n  },\n  mounted() {\n    this.loadRandomProducts();\n  }\n};","map":{"version":3,"names":["ProductList","JSONbig","name","components","data","searchQuery","showCategoryDropdown","cartCount","selectedCategory","username","localStorage","getItem","categories","id","products","computed","filteredProducts","list","filter","p","category","includes","methods","handleSearch","console","log","filterByCategory","categoryId","find","c","switchTab","tab","$router","push","addToCart","product","loadRandomProducts","res","fetch","text","parse","map","imgs","Array","isArray","images","trim","startsWith","JSON","String","firstImage","length","e","error","logout","clear","$message","success","mounted"],"sources":["D:\\Desktop\\ecomplat\\src\\views\\UserHome.vue"],"sourcesContent":["<template>\r\n    <div class=\"user-home\">\r\n      <!-- 顶部欢迎栏 -->\r\n      <div class=\"welcome-bar\">\r\n        <span class=\"welcome-text\">欢迎回来，{{ username }}！</span>\r\n        <button @click=\"logout\" class=\"logout-btn\">退出登录</button>\r\n      </div>\r\n  \r\n      <!-- 搜索栏 -->\r\n      <div class=\"search-container\">\r\n        <div class=\"search-bar\">\r\n          <input\r\n            v-model=\"searchQuery\"\r\n            type=\"text\"\r\n            placeholder=\"搜索商品...\"\r\n          >\r\n          <button @click=\"handleSearch\">搜索</button>\r\n        </div>\r\n      </div>\r\n  \r\n      <!-- 主导航栏 -->\r\n      <nav class=\"main-nav\">\r\n        <div\r\n          class=\"nav-item\"\r\n          @mouseenter=\"showCategoryDropdown = true\"\r\n          @mouseleave=\"showCategoryDropdown = false\"\r\n        >\r\n          商品分类\r\n          <div v-if=\"showCategoryDropdown\" class=\"dropdown-menu\">\r\n            <div\r\n              v-for=\"category in categories\"\r\n              :key=\"category.id\"\r\n              class=\"dropdown-item\"\r\n              @click=\"filterByCategory(category.id)\"\r\n            >\r\n              {{ category.name }}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"nav-item\" @click=\"switchTab('orders')\">我的订单</div>\r\n        <div class=\"nav-item\" @click=\"switchTab('user_profile')\">个人中心</div>\r\n        <div class=\"nav-item cart\" @click=\"switchTab('cart')\">\r\n          购物车\r\n          <span v-if=\"cartCount > 0\" class=\"cart-badge\">{{ cartCount }}</span>\r\n        </div>\r\n      </nav>\r\n  \r\n      <!-- 商品列表 -->\r\n      <ProductList :products=\"filteredProducts\" @add-to-cart=\"addToCart\" />\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import ProductList from '@/components/ProductList.vue'\r\n  import JSONbig from 'json-bigint'\r\n\r\n  export default {\r\n    name: 'UserHome',\r\n    components: { ProductList },\r\n    data() {\r\n      return {\r\n        searchQuery: '',\r\n        showCategoryDropdown: false,\r\n        cartCount: 0,\r\n        selectedCategory: null,\r\n        username: localStorage.getItem('username') || '用户',\r\n        categories: [\r\n          { id: 1, name: '白酒' },\r\n          { id: 2, name: '红酒' },\r\n          { id: 3, name: '啤酒' },\r\n          { id: 4, name: '洋酒' },\r\n          { id: 5, name: '黄酒' },\r\n          { id: 6, name: '果酒' },\r\n          { id: 7, name: '保健酒' },\r\n          { id: 8, name: '其他酒类' }\r\n        ],\r\n        products: [] // 原来是写死数组，现在为空\r\n      }\r\n    },\r\n    computed: {\r\n      filteredProducts() {\r\n        let list = this.products\r\n        if (this.selectedCategory) {\r\n          list = list.filter(p => p.category === this.selectedCategory)\r\n        }\r\n        if (this.searchQuery) {\r\n          list = list.filter(p => p.name.includes(this.searchQuery))\r\n        }\r\n        return list\r\n      }\r\n    },\r\n    methods: {\r\n      handleSearch() {\r\n        console.log('搜索:', this.searchQuery)\r\n      },\r\n      filterByCategory(categoryId) {\r\n        this.selectedCategory = this.categories.find(c => c.id === categoryId).name\r\n        this.showCategoryDropdown = false\r\n      },\r\n      switchTab(tab) {\r\n        if (tab === 'user_profile') this.$router.push('/user_profile')\r\n      },\r\n      addToCart(product) {\r\n        this.cartCount++\r\n        console.log('添加到购物车:', product.name)\r\n      },\r\n      async loadRandomProducts() {\r\n        try {\r\n          const res = await fetch('http://localhost:8081/api/random?limit=5');\r\n          const text = await res.text(); // 🔥先看原始字符串\r\n          //console.log('原始响应文本:', text);\r\n          const list = JSONbig.parse(text); // 🔥再解析 JSON\r\n          //console.log('解析后第一个商品ID:', list[0].id, typeof list[0].id);\r\n          this.products = list.map(p => {\r\n          // 先保证 images 一定是数组\r\n          let imgs = [];\r\n          if (Array.isArray(p.images)) {\r\n            imgs = p.images;\r\n          } else if (typeof p.images === 'string' && p.images.trim().startsWith('[')) {\r\n            try {\r\n              imgs = JSON.parse(p.images);\r\n            } catch { /* ignore */ }\r\n          }\r\n          return {\r\n            ...p,\r\n            id: String(p.id), // 🔥关键修复：防止精度丢失\r\n            firstImage: imgs.length ? imgs[0] : null\r\n          };\r\n        });\r\n      } catch (e) {\r\n        console.error('拉取商品失败', e);\r\n      }\r\n    },\r\n      logout() {\r\n        localStorage.clear()\r\n        this.$message?.success?.('已退出登录')\r\n        this.$router.push('/')\r\n      }\r\n    },\r\n    mounted() {\r\n      this.loadRandomProducts()\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .user-home {\r\n    font-family: 'Arial', sans-serif;\r\n    display: flex;\r\n    flex-direction: column;\r\n    min-height: 100vh;\r\n  }\r\n  \r\n  .welcome-bar {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: 15px 20px;\r\n    background: #f5f5f5;\r\n    border-bottom: 1px solid #eee;\r\n  }\r\n  .welcome-text {\r\n    font-size: 16px;\r\n    color: #333;\r\n  }\r\n  .logout-btn {\r\n    padding: 6px 12px;\r\n    background: #ff4d4f;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 4px;\r\n    cursor: pointer;\r\n  }\r\n  .logout-btn:hover {\r\n    background: #ff7875;\r\n  }\r\n  \r\n  .search-container {\r\n    padding: 1rem 2rem;\r\n    background-color: white;\r\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n  }\r\n  .search-bar {\r\n    display: flex;\r\n    max-width: 800px;\r\n    margin: 0 auto;\r\n  }\r\n  .search-bar input {\r\n    flex: 1;\r\n    padding: 0.75rem;\r\n    border: 1px solid #ddd;\r\n    border-radius: 4px 0 0 4px;\r\n    font-size: 1rem;\r\n  }\r\n  .search-bar button {\r\n    padding: 0 1.5rem;\r\n    background-color: #1890ff;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 0 4px 4px 0;\r\n    cursor: pointer;\r\n    font-size: 1rem;\r\n  }\r\n  \r\n  .main-nav {\r\n    display: grid;\r\n    grid-template-columns: repeat(4, 1fr);\r\n    padding: 15px 0;\r\n    background-color: #1890ff;\r\n    color: white;\r\n    text-align: center;\r\n  }\r\n  .nav-item {\r\n    position: relative;\r\n    padding: 8px 0;\r\n    cursor: pointer;\r\n    font-weight: 500;\r\n    transition: all 0.2s;\r\n  }\r\n  .nav-item:hover {\r\n    transform: translateY(-2px);\r\n  }\r\n  .dropdown-menu {\r\n    position: absolute;\r\n    top: 100%;\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n    background-color: white;\r\n    border-radius: 4px;\r\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n    width: 150px;\r\n    z-index: 100;\r\n  }\r\n  .dropdown-item {\r\n    padding: 0.75rem 1rem;\r\n    color: #333;\r\n    border-bottom: 1px solid #eee;\r\n  }\r\n  .dropdown-item:hover {\r\n    background-color: #f5f5f5;\r\n  }\r\n  .cart {\r\n    position: relative;\r\n  }\r\n  .cart-badge {\r\n    position: absolute;\r\n    top: -5px;\r\n    right: 10px;\r\n    background-color: #f56c6c;\r\n    color: white;\r\n    border-radius: 50%;\r\n    width: 18px;\r\n    height: 18px;\r\n    font-size: 12px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n  \r\n  @media (max-width: 768px) {\r\n    .main-nav {\r\n      grid-template-columns: 1fr;\r\n      gap: 10px;\r\n    }\r\n    .welcome-bar {\r\n      padding: 10px;\r\n      font-size: 14px;\r\n    }\r\n  }\r\n  </style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}