{"ast":null,"code":"import { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createTextVNode as _createTextVNode, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"add-goods\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_form_item = _resolveComponent(\"el-form-item\");\n  const _component_el_option = _resolveComponent(\"el-option\");\n  const _component_el_select = _resolveComponent(\"el-select\");\n  const _component_el_input_number = _resolveComponent(\"el-input-number\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_upload = _resolveComponent(\"el-upload\");\n  const _component_el_form = _resolveComponent(\"el-form\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[10] || (_cache[10] = _createElementVNode(\"h2\", null, \"上架商品\", -1 /* CACHED */)), _createVNode(_component_el_form, {\n    model: $setup.form,\n    \"label-width\": \"120px\",\n    style: {\n      \"max-width\": \"680px\"\n    }\n  }, {\n    default: _withCtx(() => [_createCommentVNode(\" 商品名称 \"), _createVNode(_component_el_form_item, {\n      label: \"商品名称\",\n      required: \"\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        modelValue: $setup.form.name,\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.form.name = $event),\n        placeholder: \"请输入商品名称\"\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createCommentVNode(\" 提供服务 \"), _createVNode(_component_el_form_item, {\n      label: \"提供服务\",\n      required: \"\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        modelValue: $setup.form.service,\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.form.service = $event),\n        placeholder: \"例如：上门维修、代排队等\"\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createCommentVNode(\" 分类 \"), _createVNode(_component_el_form_item, {\n      label: \"商品分类\",\n      required: \"\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_select, {\n        modelValue: $setup.form.category,\n        \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.form.category = $event),\n        placeholder: \"请选择分类\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_option, {\n          label: \"维修\",\n          value: \"repair\"\n        }), _createVNode(_component_el_option, {\n          label: \"跑腿\",\n          value: \"errand\"\n        }), _createVNode(_component_el_option, {\n          label: \"家政\",\n          value: \"housekeeping\"\n        })]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createCommentVNode(\" 单价 \"), _createVNode(_component_el_form_item, {\n      label: \"单价（元）\",\n      required: \"\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input_number, {\n        modelValue: $setup.form.price,\n        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $setup.form.price = $event),\n        min: 0,\n        precision: 2\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createCommentVNode(\" 库存 \"), _createVNode(_component_el_form_item, {\n      label: \"库存\",\n      required: \"\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input_number, {\n        modelValue: $setup.form.stock,\n        \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => $setup.form.stock = $event),\n        min: 0\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createCommentVNode(\" 商品描述 \"), _createVNode(_component_el_form_item, {\n      label: \"商品描述\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        type: \"textarea\",\n        rows: 3,\n        modelValue: $setup.form.description,\n        \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => $setup.form.description = $event),\n        placeholder: \"简要描述商品亮点\"\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createCommentVNode(\" 商品详情 key-value \"), _createVNode(_component_el_form_item, {\n      label: \"商品详情\",\n      required: \"\"\n    }, {\n      default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.form.details, (item, idx) => {\n        return _openBlock(), _createElementBlock(\"div\", {\n          key: idx,\n          style: {\n            \"display\": \"flex\",\n            \"gap\": \"8px\",\n            \"margin-bottom\": \"8px\"\n          }\n        }, [_createVNode(_component_el_input, {\n          modelValue: item.key,\n          \"onUpdate:modelValue\": $event => item.key = $event,\n          placeholder: \"属性名\",\n          style: {\n            \"width\": \"140px\"\n          }\n        }, null, 8 /* PROPS */, [\"modelValue\", \"onUpdate:modelValue\"]), _createVNode(_component_el_input, {\n          modelValue: item.value,\n          \"onUpdate:modelValue\": $event => item.value = $event,\n          placeholder: \"属性值\",\n          style: {\n            \"flex\": \"1\"\n          }\n        }, null, 8 /* PROPS */, [\"modelValue\", \"onUpdate:modelValue\"]), $setup.form.details.length > 1 ? (_openBlock(), _createBlock(_component_el_button, {\n          key: 0,\n          type: \"danger\",\n          size: \"small\",\n          onClick: $event => $setup.removeDetail(idx)\n        }, {\n          default: _withCtx(() => [...(_cache[6] || (_cache[6] = [_createTextVNode(\"删\")]))]),\n          _: 2 /* DYNAMIC */,\n          __: [6]\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])) : _createCommentVNode(\"v-if\", true)]);\n      }), 128 /* KEYED_FRAGMENT */)), $setup.form.details.length < 10 ? (_openBlock(), _createBlock(_component_el_button, {\n        key: 0,\n        type: \"primary\",\n        size: \"small\",\n        onClick: $setup.addDetail\n      }, {\n        default: _withCtx(() => _cache[7] || (_cache[7] = [_createTextVNode(\"+ 添加属性\")])),\n        _: 1 /* STABLE */,\n        __: [7]\n      })) : _createCommentVNode(\"v-if\", true)]),\n      _: 1 /* STABLE */\n    }), _createCommentVNode(\" 商品图片 \"), _createVNode(_component_el_form_item, {\n      label: \"商品图片\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_upload, {\n        ref: \"uploadRef\",\n        \"list-type\": \"picture\",\n        limit: 5,\n        \"file-list\": $setup.fileList,\n        \"before-upload\": $setup.beforeUpload,\n        \"on-change\": $setup.handleChange,\n        \"on-remove\": $setup.handleRemove,\n        \"auto-upload\": false,\n        multiple: \"\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_button, {\n          type: \"primary\"\n        }, {\n          default: _withCtx(() => _cache[8] || (_cache[8] = [_createTextVNode(\"选择图片（最多 5 张）\")])),\n          _: 1 /* STABLE */,\n          __: [8]\n        })]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"file-list\"])]),\n      _: 1 /* STABLE */\n    }), _createCommentVNode(\" 提交 \"), _createVNode(_component_el_form_item, null, {\n      default: _withCtx(() => [_createVNode(_component_el_button, {\n        type: \"primary\",\n        onClick: $setup.submitForm\n      }, {\n        default: _withCtx(() => _cache[9] || (_cache[9] = [_createTextVNode(\"上架商品\")])),\n        _: 1 /* STABLE */,\n        __: [9]\n      })]),\n      _: 1 /* STABLE */\n    })]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"model\"])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_createVNode","_component_el_form","model","$setup","form","style","_createCommentVNode","_component_el_form_item","label","required","_component_el_input","name","$event","placeholder","service","_component_el_select","category","_component_el_option","value","_component_el_input_number","price","min","precision","stock","type","rows","description","_Fragment","_renderList","details","item","idx","key","length","_createBlock","_component_el_button","size","onClick","removeDetail","_cache","addDetail","_component_el_upload","ref","limit","fileList","beforeUpload","handleChange","handleRemove","multiple","submitForm"],"sources":["D:\\Desktop\\ecomplat\\src\\views\\AddGoods.vue"],"sourcesContent":["<template>\r\n  <div class=\"add-goods\">\r\n    <h2>上架商品</h2>\r\n\r\n    <el-form :model=\"form\" label-width=\"120px\" style=\"max-width: 680px\">\r\n      <!-- 商品名称 -->\r\n      <el-form-item label=\"商品名称\" required>\r\n        <el-input v-model=\"form.name\" placeholder=\"请输入商品名称\" />\r\n      </el-form-item>\r\n\r\n      <!-- 提供服务 -->\r\n      <el-form-item label=\"提供服务\" required>\r\n        <el-input v-model=\"form.service\" placeholder=\"例如：上门维修、代排队等\" />\r\n      </el-form-item>\r\n\r\n      <!-- 分类 -->\r\n      <el-form-item label=\"商品分类\" required>\r\n        <el-select v-model=\"form.category\" placeholder=\"请选择分类\">\r\n          <el-option label=\"维修\" value=\"repair\" />\r\n          <el-option label=\"跑腿\" value=\"errand\" />\r\n          <el-option label=\"家政\" value=\"housekeeping\" />\r\n        </el-select>\r\n      </el-form-item>\r\n\r\n      <!-- 单价 -->\r\n      <el-form-item label=\"单价（元）\" required>\r\n        <el-input-number v-model=\"form.price\" :min=\"0\" :precision=\"2\" />\r\n      </el-form-item>\r\n\r\n      <!-- 库存 -->\r\n      <el-form-item label=\"库存\" required>\r\n        <el-input-number v-model=\"form.stock\" :min=\"0\" />\r\n      </el-form-item>\r\n\r\n      <!-- 商品描述 -->\r\n      <el-form-item label=\"商品描述\">\r\n        <el-input\r\n          type=\"textarea\"\r\n          :rows=\"3\"\r\n          v-model=\"form.description\"\r\n          placeholder=\"简要描述商品亮点\"\r\n        />\r\n      </el-form-item>\r\n\r\n      <!-- 商品详情 key-value -->\r\n      <el-form-item label=\"商品详情\" required>\r\n        <div\r\n          v-for=\"(item, idx) in form.details\"\r\n          :key=\"idx\"\r\n          style=\"display:flex;gap:8px;margin-bottom:8px\"\r\n        >\r\n          <el-input v-model=\"item.key\" placeholder=\"属性名\" style=\"width:140px\" />\r\n          <el-input v-model=\"item.value\" placeholder=\"属性值\" style=\"flex:1\" />\r\n          <el-button\r\n            v-if=\"form.details.length > 1\"\r\n            type=\"danger\"\r\n            size=\"small\"\r\n            @click=\"removeDetail(idx)\"\r\n            >删</el-button\r\n          >\r\n        </div>\r\n        <el-button\r\n          v-if=\"form.details.length < 10\"\r\n          type=\"primary\"\r\n          size=\"small\"\r\n          @click=\"addDetail\"\r\n          >+ 添加属性</el-button\r\n        >\r\n      </el-form-item>\r\n\r\n      <!-- 商品图片 -->\r\n      <el-form-item label=\"商品图片\">\r\n        <el-upload\r\n          ref=\"uploadRef\"\r\n          list-type=\"picture\"\r\n          :limit=\"5\"\r\n          :file-list=\"fileList\"\r\n          :before-upload=\"beforeUpload\"\r\n          :on-change=\"handleChange\"\r\n          :on-remove=\"handleRemove\"\r\n          :auto-upload=\"false\"\r\n          multiple\r\n        >\r\n          <el-button type=\"primary\">选择图片（最多 5 张）</el-button>\r\n        </el-upload>\r\n      </el-form-item>\r\n\r\n      <!-- 提交 -->\r\n      <el-form-item>\r\n        <el-button type=\"primary\" @click=\"submitForm\">上架商品</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { reactive, ref } from 'vue'\r\nimport { ElMessage } from 'element-plus'\r\nimport { addGoods, uploadImage } from '@/api/goods'\r\nimport { useRouter } from 'vue-router'\r\n\r\nconst router = useRouter()\r\n\r\n/* 表单数据 */\r\nconst form = reactive({\r\n  name: '',\r\n  service: '',\r\n  category: '',\r\n  price: 0,\r\n  stock: 0,\r\n  description: '',\r\n  details: [{ key: '', value: '' }],\r\n  images: []\r\n})\r\n\r\n/* 本地预览列表 */\r\nconst fileList = ref([])\r\n\r\n/* 添加 / 删除详情 */\r\nconst addDetail = () => {\r\n  if (form.details.length < 10) form.details.push({ key: '', value: '' })\r\n}\r\nconst removeDetail = idx => form.details.splice(idx, 1)\r\n\r\n/* 选图变化时同步 fileList，用于本地预览 */\r\nconst handleChange = (_, list) => {\r\n  fileList.value = list\r\n}\r\n\r\n/* 删除 */\r\nconst handleRemove = (_, list) => {\r\n  fileList.value = list\r\n}\r\n\r\n/* 文件格式/大小校验 */\r\nconst beforeUpload = (file) => {\r\n  const isImg = file.type.startsWith('image/')\r\n  const isLt2M = file.size / 1024 / 1024 < 2\r\n  if (!isImg) ElMessage.error('只能上传图片')\r\n  if (!isLt2M) ElMessage.error('图片不能大于 2MB')\r\n  return isImg && isLt2M\r\n}\r\n\r\n/* 提交：先批量上传图片，再提交整体数据 */\r\nconst submitForm = async () => {\r\n  if (!form.name || !form.service || !form.category) {\r\n    return ElMessage.error('请填写必填项')\r\n  }\r\n  \r\n  const validDetails = form.details.filter(\r\n    d => d.key.trim() && d.value.trim()\r\n  )\r\n  if (form.details.length && !validDetails.length) {\r\n    return ElMessage.error('请至少填写一条有效商品详情')\r\n  }\r\n  \r\n  const merchantId = Number(localStorage.getItem('uid')) // ✅ 取出商家ID\r\n  if (!merchantId) {\r\n    ElMessage.error('未登录，请先登录')\r\n    return router.push('/')\r\n  }\r\n\r\n  try {\r\n    // 1. 上传所有图片\r\n    const uploadTasks = fileList.value.map(f =>\r\n      uploadImage(f.raw).then(res => res.data.url)\r\n    )\r\n    const imageUrls = await Promise.all(uploadTasks)\r\n\r\n    // 2. 提交完整数据\r\n    const payload = {\r\n      ...form,\r\n      merchantId,\r\n      images: imageUrls,\r\n      details: validDetails\r\n    }\r\n    await addGoods(payload)\r\n    ElMessage.success('商品上架成功')\r\n    router.push('/goods')\r\n  } catch (e) {\r\n    ElMessage.error('上架失败')\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.add-goods {\r\n  padding: 20px;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}