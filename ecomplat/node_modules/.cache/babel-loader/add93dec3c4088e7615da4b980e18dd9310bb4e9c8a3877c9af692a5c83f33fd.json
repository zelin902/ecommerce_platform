{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"user-home\"\n};\nconst _hoisted_2 = {\n  class: \"welcome-bar\"\n};\nconst _hoisted_3 = {\n  class: \"welcome-text\"\n};\nconst _hoisted_4 = {\n  class: \"search-container\"\n};\nconst _hoisted_5 = {\n  class: \"search-bar\"\n};\nconst _hoisted_6 = {\n  class: \"main-nav\"\n};\nconst _hoisted_7 = {\n  key: 0,\n  class: \"dropdown-menu\"\n};\nconst _hoisted_8 = [\"onClick\"];\nconst _hoisted_9 = {\n  key: 0,\n  class: \"cart-badge\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_ProductList = _resolveComponent(\"ProductList\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" 顶部欢迎栏 \"), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"span\", _hoisted_3, \"欢迎回来，\" + _toDisplayString($data.username) + \"！\", 1 /* TEXT */), _createElementVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.logout && $options.logout(...args)),\n    class: \"logout-btn\"\n  }, \"退出登录\")]), _createCommentVNode(\" 搜索栏 \"), _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"div\", _hoisted_5, [_withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.searchQuery = $event),\n    type: \"text\",\n    placeholder: \"搜索商品...\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.searchQuery]]), _createElementVNode(\"button\", {\n    onClick: _cache[2] || (_cache[2] = (...args) => $options.handleSearch && $options.handleSearch(...args))\n  }, \"搜索\")])]), _createCommentVNode(\" 主导航栏 \"), _createElementVNode(\"nav\", _hoisted_6, [_createElementVNode(\"div\", {\n    class: \"nav-item\",\n    onMouseenter: _cache[3] || (_cache[3] = $event => $data.showCategoryDropdown = true),\n    onMouseleave: _cache[4] || (_cache[4] = $event => $data.showCategoryDropdown = false)\n  }, [_cache[8] || (_cache[8] = _createTextVNode(\" 商品分类 \")), $data.showCategoryDropdown ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.categories, category => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: category.id,\n      class: \"dropdown-item\",\n      onClick: $event => $options.filterByCategory(category.id)\n    }, _toDisplayString(category.name), 9 /* TEXT, PROPS */, _hoisted_8);\n  }), 128 /* KEYED_FRAGMENT */))])) : _createCommentVNode(\"v-if\", true)], 32 /* NEED_HYDRATION */), _createElementVNode(\"div\", {\n    class: \"nav-item\",\n    onClick: _cache[5] || (_cache[5] = $event => $options.switchTab('orders'))\n  }, \"我的订单\"), _createElementVNode(\"div\", {\n    class: \"nav-item\",\n    onClick: _cache[6] || (_cache[6] = $event => $options.switchTab('user_profile'))\n  }, \"个人中心\"), _createElementVNode(\"div\", {\n    class: \"nav-item cart\",\n    onClick: _cache[7] || (_cache[7] = (...args) => $options.goToCart && $options.goToCart(...args))\n  }, [_cache[9] || (_cache[9] = _createTextVNode(\" 购物车 \")), $data.cartCount > 0 ? (_openBlock(), _createElementBlock(\"span\", _hoisted_9, _toDisplayString($data.cartCount), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)])]), _createCommentVNode(\" 商品列表 \"), _createVNode(_component_ProductList, {\n    products: $options.filteredProducts,\n    onAddToCart: $options.addToCart\n  }, null, 8 /* PROPS */, [\"products\", \"onAddToCart\"])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createCommentVNode","_createElementVNode","_hoisted_2","_hoisted_3","_toDisplayString","$data","username","onClick","_cache","args","$options","logout","_hoisted_4","_hoisted_5","searchQuery","$event","type","placeholder","handleSearch","_hoisted_6","onMouseenter","showCategoryDropdown","onMouseleave","_hoisted_7","_Fragment","_renderList","categories","category","key","id","filterByCategory","name","_hoisted_8","switchTab","goToCart","cartCount","_hoisted_9","_createVNode","_component_ProductList","products","filteredProducts","onAddToCart","addToCart"],"sources":["D:\\Desktop\\ecomplat\\src\\views\\UserHome.vue"],"sourcesContent":["<template>\r\n    <div class=\"user-home\">\r\n      <!-- 顶部欢迎栏 -->\r\n      <div class=\"welcome-bar\">\r\n        <span class=\"welcome-text\">欢迎回来，{{ username }}！</span>\r\n        <button @click=\"logout\" class=\"logout-btn\">退出登录</button>\r\n      </div>\r\n  \r\n      <!-- 搜索栏 -->\r\n      <div class=\"search-container\">\r\n        <div class=\"search-bar\">\r\n          <input\r\n            v-model=\"searchQuery\"\r\n            type=\"text\"\r\n            placeholder=\"搜索商品...\"\r\n          >\r\n          <button @click=\"handleSearch\">搜索</button>\r\n        </div>\r\n      </div>\r\n  \r\n      <!-- 主导航栏 -->\r\n      <nav class=\"main-nav\">\r\n        <div\r\n          class=\"nav-item\"\r\n          @mouseenter=\"showCategoryDropdown = true\"\r\n          @mouseleave=\"showCategoryDropdown = false\"\r\n        >\r\n          商品分类\r\n          <div v-if=\"showCategoryDropdown\" class=\"dropdown-menu\">\r\n            <div\r\n              v-for=\"category in categories\"\r\n              :key=\"category.id\"\r\n              class=\"dropdown-item\"\r\n              @click=\"filterByCategory(category.id)\"\r\n            >\r\n              {{ category.name }}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"nav-item\" @click=\"switchTab('orders')\">我的订单</div>\r\n        <div class=\"nav-item\" @click=\"switchTab('user_profile')\">个人中心</div>\r\n        <div class=\"nav-item cart\" @click=\"goToCart\">\r\n        购物车\r\n        <span v-if=\"cartCount > 0\" class=\"cart-badge\">{{ cartCount }}</span>\r\n      </div>\r\n      </nav>\r\n  \r\n      <!-- 商品列表 -->\r\n      <ProductList :products=\"filteredProducts\" @add-to-cart=\"addToCart\" />\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import ProductList from '@/components/ProductList.vue'\r\n  import JSONbig from 'json-bigint'\r\n\r\n  export default {\r\n    name: 'UserHome',\r\n    components: { ProductList },\r\n    data() {\r\n      return {\r\n        searchQuery: '',\r\n        showCategoryDropdown: false,\r\n        cartCount: 0,\r\n        selectedCategory: null,\r\n        username: localStorage.getItem('username') || '用户',\r\n        categories: [\r\n          { id: 1, name: '白酒' },\r\n          { id: 2, name: '红酒' },\r\n          { id: 3, name: '啤酒' },\r\n          { id: 4, name: '洋酒' },\r\n          { id: 5, name: '黄酒' },\r\n          { id: 6, name: '果酒' },\r\n          { id: 7, name: '保健酒' },\r\n          { id: 8, name: '其他酒类' }\r\n        ],\r\n        products: [], // 原来是写死数组，现在为空\r\n        cartCount: 0 // 可通过接口或全局状态同步购物车数量\r\n      }\r\n    },\r\n    computed: {\r\n      filteredProducts() {\r\n        let list = this.products\r\n        if (this.selectedCategory) {\r\n          list = list.filter(p => p.category === this.selectedCategory)\r\n        }\r\n        if (this.searchQuery) {\r\n          list = list.filter(p => p.name.includes(this.searchQuery))\r\n        }\r\n        return list\r\n      }\r\n    },\r\n    methods: {\r\n      goToCart() {\r\n      this.$router.push('/cart') // 跳转到购物车路由\r\n    },\r\n      handleSearch() {\r\n        console.log('搜索:', this.searchQuery)\r\n      },\r\n      filterByCategory(categoryId) {\r\n        this.selectedCategory = this.categories.find(c => c.id === categoryId).name\r\n        this.showCategoryDropdown = false\r\n      },\r\n      switchTab(tab) {\r\n        if (tab === 'user_profile') this.$router.push('/user_profile')\r\n      },\r\n      addToCart(product) {\r\n        this.cartCount++\r\n        console.log('添加到购物车:', product.name)\r\n      },\r\n      async loadRandomProducts() {\r\n        try {\r\n          const res = await fetch('http://localhost:8081/api/random?limit=5');\r\n          const text = await res.text(); // 🔥先看原始字符串\r\n          //console.log('原始响应文本:', text);\r\n          const list = JSONbig.parse(text); // 🔥再解析 JSON\r\n          //console.log('解析后第一个商品ID:', list[0].id, typeof list[0].id);\r\n          this.products = list.map(p => {\r\n          // 先保证 images 一定是数组\r\n          let imgs = [];\r\n          if (Array.isArray(p.images)) {\r\n            imgs = p.images;\r\n          } else if (typeof p.images === 'string' && p.images.trim().startsWith('[')) {\r\n            try {\r\n              imgs = JSON.parse(p.images);\r\n            } catch { /* ignore */ }\r\n          }\r\n          return {\r\n            ...p,\r\n            id: String(p.id), // 🔥关键修复：防止精度丢失\r\n            firstImage: imgs.length ? imgs[0] : null\r\n          };\r\n        });\r\n      } catch (e) {\r\n        console.error('拉取商品失败', e);\r\n      }\r\n    },\r\n      logout() {\r\n        localStorage.clear()\r\n        this.$message?.success?.('已退出登录')\r\n        this.$router.push('/')\r\n      }\r\n    },\r\n    mounted() {\r\n      this.loadRandomProducts()\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .user-home {\r\n    font-family: 'Arial', sans-serif;\r\n    display: flex;\r\n    flex-direction: column;\r\n    min-height: 100vh;\r\n  }\r\n  \r\n  .welcome-bar {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: 15px 20px;\r\n    background: #f5f5f5;\r\n    border-bottom: 1px solid #eee;\r\n  }\r\n  .welcome-text {\r\n    font-size: 16px;\r\n    color: #333;\r\n  }\r\n  .logout-btn {\r\n    padding: 6px 12px;\r\n    background: #ff4d4f;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 4px;\r\n    cursor: pointer;\r\n  }\r\n  .logout-btn:hover {\r\n    background: #ff7875;\r\n  }\r\n  \r\n  .search-container {\r\n    padding: 1rem 2rem;\r\n    background-color: white;\r\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n  }\r\n  .search-bar {\r\n    display: flex;\r\n    max-width: 800px;\r\n    margin: 0 auto;\r\n  }\r\n  .search-bar input {\r\n    flex: 1;\r\n    padding: 0.75rem;\r\n    border: 1px solid #ddd;\r\n    border-radius: 4px 0 0 4px;\r\n    font-size: 1rem;\r\n  }\r\n  .search-bar button {\r\n    padding: 0 1.5rem;\r\n    background-color: #1890ff;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 0 4px 4px 0;\r\n    cursor: pointer;\r\n    font-size: 1rem;\r\n  }\r\n  \r\n  .main-nav {\r\n    display: grid;\r\n    grid-template-columns: repeat(4, 1fr);\r\n    padding: 15px 0;\r\n    background-color: #1890ff;\r\n    color: white;\r\n    text-align: center;\r\n  }\r\n  .nav-item {\r\n    position: relative;\r\n    padding: 8px 0;\r\n    cursor: pointer;\r\n    font-weight: 500;\r\n    transition: all 0.2s;\r\n  }\r\n  .nav-item:hover {\r\n    transform: translateY(-2px);\r\n  }\r\n  .dropdown-menu {\r\n    position: absolute;\r\n    top: 100%;\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n    background-color: white;\r\n    border-radius: 4px;\r\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n    width: 150px;\r\n    z-index: 100;\r\n  }\r\n  .dropdown-item {\r\n    padding: 0.75rem 1rem;\r\n    color: #333;\r\n    border-bottom: 1px solid #eee;\r\n  }\r\n  .dropdown-item:hover {\r\n    background-color: #f5f5f5;\r\n  }\r\n  .cart {\r\n    position: relative;\r\n  }\r\n  .cart-badge {\r\n    position: absolute;\r\n    top: -5px;\r\n    right: 10px;\r\n    background-color: #f56c6c;\r\n    color: white;\r\n    border-radius: 50%;\r\n    width: 18px;\r\n    height: 18px;\r\n    font-size: 12px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n  \r\n  @media (max-width: 768px) {\r\n    .main-nav {\r\n      grid-template-columns: 1fr;\r\n      gap: 10px;\r\n    }\r\n    .welcome-bar {\r\n      padding: 10px;\r\n      font-size: 14px;\r\n    }\r\n  }\r\n  </style>"],"mappings":";;EACSA,KAAK,EAAC;AAAW;;EAEfA,KAAK,EAAC;AAAa;;EAChBA,KAAK,EAAC;AAAc;;EAKvBA,KAAK,EAAC;AAAkB;;EACtBA,KAAK,EAAC;AAAY;;EAWpBA,KAAK,EAAC;AAAU;;;EAOgBA,KAAK,EAAC;;;;;EAedA,KAAK,EAAC;;;;uBA1CrCC,mBAAA,CAgDM,OAhDNC,UAgDM,GA/CJC,mBAAA,WAAc,EACdC,mBAAA,CAGM,OAHNC,UAGM,GAFJD,mBAAA,CAAsD,QAAtDE,UAAsD,EAA3B,OAAK,GAAAC,gBAAA,CAAGC,KAAA,CAAAC,QAAQ,IAAG,GAAC,iBAC/CL,mBAAA,CAAwD;IAA/CM,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAC,MAAA,IAAAD,QAAA,CAAAC,MAAA,IAAAF,IAAA,CAAM;IAAEZ,KAAK,EAAC;KAAa,MAAI,E,GAGjDG,mBAAA,SAAY,EACZC,mBAAA,CASM,OATNW,UASM,GARJX,mBAAA,CAOM,OAPNY,UAOM,G,gBANJZ,mBAAA,CAIC;+DAHUI,KAAA,CAAAS,WAAW,GAAAC,MAAA;IACpBC,IAAI,EAAC,MAAM;IACXC,WAAW,EAAC;iDAFHZ,KAAA,CAAAS,WAAW,E,GAItBb,mBAAA,CAAyC;IAAhCM,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAQ,YAAA,IAAAR,QAAA,CAAAQ,YAAA,IAAAT,IAAA,CAAY;KAAE,IAAE,E,KAIpCT,mBAAA,UAAa,EACbC,mBAAA,CAwBM,OAxBNkB,UAwBM,GAvBJlB,mBAAA,CAgBM;IAfJJ,KAAK,EAAC,UAAU;IACfuB,YAAU,EAAAZ,MAAA,QAAAA,MAAA,MAAAO,MAAA,IAAEV,KAAA,CAAAgB,oBAAoB;IAChCC,YAAU,EAAAd,MAAA,QAAAA,MAAA,MAAAO,MAAA,IAAEV,KAAA,CAAAgB,oBAAoB;iDAClC,QAEC,IAAWhB,KAAA,CAAAgB,oBAAoB,I,cAA/BvB,mBAAA,CASM,OATNyB,UASM,I,kBARJzB,mBAAA,CAOM0B,SAAA,QAAAC,WAAA,CANepB,KAAA,CAAAqB,UAAU,EAAtBC,QAAQ;yBADjB7B,mBAAA,CAOM;MALH8B,GAAG,EAAED,QAAQ,CAACE,EAAE;MACjBhC,KAAK,EAAC,eAAe;MACpBU,OAAK,EAAAQ,MAAA,IAAEL,QAAA,CAAAoB,gBAAgB,CAACH,QAAQ,CAACE,EAAE;wBAEjCF,QAAQ,CAACI,IAAI,wBAAAC,UAAA;oGAItB/B,mBAAA,CAA6D;IAAxDJ,KAAK,EAAC,UAAU;IAAEU,OAAK,EAAAC,MAAA,QAAAA,MAAA,MAAAO,MAAA,IAAEL,QAAA,CAAAuB,SAAS;KAAY,MAAI,GACvDhC,mBAAA,CAAmE;IAA9DJ,KAAK,EAAC,UAAU;IAAEU,OAAK,EAAAC,MAAA,QAAAA,MAAA,MAAAO,MAAA,IAAEL,QAAA,CAAAuB,SAAS;KAAkB,MAAI,GAC7DhC,mBAAA,CAGI;IAHCJ,KAAK,EAAC,eAAe;IAAEU,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAwB,QAAA,IAAAxB,QAAA,CAAAwB,QAAA,IAAAzB,IAAA,CAAQ;iDAAE,OAE7C,IAAYJ,KAAA,CAAA8B,SAAS,Q,cAArBrC,mBAAA,CAAoE,QAApEsC,UAAoE,EAAAhC,gBAAA,CAAnBC,KAAA,CAAA8B,SAAS,oB,uCAI5DnC,mBAAA,UAAa,EACbqC,YAAA,CAAqEC,sBAAA;IAAvDC,QAAQ,EAAE7B,QAAA,CAAA8B,gBAAgB;IAAGC,WAAW,EAAE/B,QAAA,CAAAgC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}